# Kế hoạch đồng bộ hóa i18n cho 84tea

**Ngày tạo**: 2026-02-14
**Trạng thái**: Đang triển khai

## Bối cảnh

Dự án 84tea đang gặp vấn đề nghiêm trọng về đồng bộ hóa i18n. Sau khi kiểm tra, đã phát hiện:
- Hơn 582 khóa dịch (translation keys) được sử dụng trong mã nguồn (`t('...')`) nhưng không có trong các tệp ngôn ngữ `messages/vi.json` và `messages/en.json`.
- Một lỗi logic nghiêm trọng trong `apps/84tea/src/app/[locale]/layout.tsx` khi sử dụng `t('@/components/cart/cart-drawer')`.
- Các file `vi.json` và `en.json` đã đồng bộ với nhau nhưng không đồng bộ với code base.

## Mục tiêu của Mission

Trong mission hiện tại, chúng ta sẽ tập trung vào việc khắc phục các vấn đề i18n, tuân thủ các quy tắc sau:
1.  **Chỉ sửa TỐI ĐA 5 file** trong mỗi mission.
2.  Ưu tiên sửa các lỗi nghiêm trọng và các file quan trọng như `layout.tsx` và các file `messages/*.json`.
3.  Báo cáo danh sách các khóa và file còn lại cần sửa nếu chưa hoàn thành trong mission này.

## Các file liên quan

-   `apps/84tea/messages/vi.json`
-   `apps/84tea/messages/en.json`
-   `apps/84tea/src/app/[locale]/layout.tsx`
-   Các file code khác có sử dụng `t('...')`

## Kế hoạch triển khai (Giai đoạn 1: 5 files đầu tiên)

### Tổng quan

Giai đoạn này sẽ tập trung vào việc sửa lỗi cú pháp trong `layout.tsx` và bổ sung các khóa dịch còn thiếu vào `messages/vi.json` và `messages/en.json`.

### Các bước thực hiện

1.  **Sửa lỗi `layout.tsx`**:
    -   Mở file `apps/84tea/src/app/[locale]/layout.tsx`.
    -   Thay thế `t('@/components/cart/cart-drawer')` bằng một khóa dịch hợp lệ (ví dụ: `t('cart.drawer_title')`) hoặc loại bỏ nếu không cần thiết.
    -   Đảm bảo không còn các chuỗi cứng (hardcoded strings) được truyền vào hàm `t()` một cách không hợp lệ.

2.  **Đồng bộ `messages/vi.json` và `messages/en.json`**:
    -   Tạo danh sách các khóa dịch còn thiếu từ mã nguồn.
    -   Đối với 582 khóa thiếu, sẽ cần bổ sung chúng vào cả `vi.json` và `en.json`. Do giới hạn 5 file, trong giai đoạn này, sẽ ưu tiên các khóa có tần suất sử dụng cao hoặc liên quan đến các thành phần quan trọng (ví dụ: navigation, hero section).
    -   Để đơn giản hóa trong mission này, sẽ bổ sung các khóa thiếu với giá trị là chính khóa đó để code không bị lỗi runtime (ví dụ: `"cart.drawer_title": "cart.drawer_title"`). Sau đó sẽ cần một mission khác để dịch các giá trị này.

3.  **Tập trung vào 5 files đầu tiên**:
    -   `apps/84tea/src/app/[locale]/layout.tsx` (sửa lỗi cú pháp t())
    -   `apps/84tea/messages/vi.json` (bổ sung các keys quan trọng)
    -   `apps/84tea/messages/en.json` (bổ sung các keys quan trọng)
    -   Tìm 2 file .tsx/jsx khác có nhiều lỗi `t()` nhất và sửa chúng.

## Tiêu chí hoàn thành (cho giai đoạn 1)

-   File `apps/84tea/src/app/[locale]/layout.tsx` không còn lỗi cú pháp liên quan đến `t()`.
-   Các file `messages/vi.json` và `messages/en.json` được cập nhật với ít nhất 10-20 khóa dịch quan trọng nhất (hoặc các khóa được tìm thấy trong 2 file .tsx/jsx được chọn sửa).
-   Đã sửa lỗi `t()` trong 2 file .tsx/jsx khác.
-   Tổng số file được sửa không quá 5.
-   Báo cáo danh sách các khóa còn thiếu và các file cần sửa thêm.

## Rủi ro và biện pháp giảm thiểu

-   **Rủi ro**: Việc bổ sung khóa dịch thủ công có thể tạo ra lỗi chính tả hoặc cấu trúc JSON không hợp lệ.
    -   **Giảm thiểu**: Sử dụng công cụ grep và kiểm tra cẩn thận trước khi commit.
-   **Rủi ro**: Lỗi runtime nếu các khóa dịch bổ sung không chính xác.
    -   **Giảm thiểu**: Kiểm tra lại ứng dụng sau khi triển khai các thay đổi.

## Các bước tiếp theo (sau khi hoàn thành giai đoạn 1)

-   Tiếp tục các mission để bổ sung và dịch các khóa dịch còn lại.
-   Chạy `npm run dev` để kiểm tra các lỗi.
-   Chạy `npm test` để đảm bảo không có lỗi regression.